<div class="app-container">
  <header class="app-header">
    <div class="header-content">
      <h1>📅 File to Calendar Converter</h1>
      <p>Convert images and PDFs to ICS calendar files</p>
    </div>
    <!-- Only show auth component in header when user is connected -->
    <div *ngIf="user$ | async" class="header-auth">
      <app-auth mode="header"></app-auth>
    </div>
  </header>

  <main class="app-main" *ngIf="user$ | async">
    <div class="converter-section" *ngIf="!showResults">
      <app-file-upload (textExtracted)="onTextExtracted($event)"></app-file-upload>
    </div>

    <div class="results-section" *ngIf="showResults && extractedText">
      <!-- Summary Stats -->
      <div class="stats-card" *ngIf="parsedEvents.length > 0">
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-number">{{ parsedEvents.length }}</span>
            <span class="stat-label">{{ parsedEvents.length === 1 ? 'Event' : 'Events' }} Found</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ extractedText.confidence ? (extractedText.confidence * 100).toFixed(0) + '%' : 'N/A' }}</span>
            <span class="stat-label">Confidence</span>
          </div>
        </div>
      </div>

      <div class="events-card" *ngIf="parsedEvents.length > 0">
        <div class="events-header">
          <h2>📅 Calendar Events</h2>
          <div class="view-toggle" *ngIf="!isMobile">
            <button 
              class="toggle-btn" 
              [class.active]="viewMode === 'grid'" 
              (click)="viewMode = 'grid'"
              title="Grid View">
              ⊞
            </button>
            <button 
              class="toggle-btn" 
              [class.active]="viewMode === 'list'" 
              (click)="viewMode = 'list'"
              title="List View">
              ☰
            </button>
          </div>
        </div>
        
        <div class="events-list" [class.list-view]="viewMode === 'list'">
          <div class="event-item" *ngFor="let event of parsedEvents; trackBy: trackEvent">
            <div class="event-header">
              <h3>{{ event.title }}</h3>
              <div class="event-header-right">
                <!-- Inline event actions -->
                <div class="event-actions inline-actions">
                  <button class="quick-action copy-btn" (click)="copyEventToClipboard(event)" title="Copy event details">
                    📋
                  </button>
                  <button class="quick-action share-btn" (click)="shareEvent(event)" title="Share event">
                    📤
                  </button>
                </div>
              </div>
            </div>
            
            <div class="event-details">
              <p class="event-date">
                📅 {{ event.startDate | date:'MMM d, y' }} at {{ event.startDate | date:'shortTime' }}
                <span class="duration" *ngIf="getEventDuration(event)">
                  ({{ getEventDuration(event) }})
                </span>
              </p>
              
              <p class="event-description" *ngIf="event.description && event.description !== event.title">
                {{ event.description }}
              </p>
              
              <div class="event-meta" *ngIf="event.location">
                <p class="event-location" *ngIf="event.location">📍 {{ event.location }}</p>
              </div>
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button
            class="download-btn"
            (click)="downloadCalendar()"
            [disabled]="isDownloading"
            [class.downloading]="isDownloading">
            <span *ngIf="!isDownloading">📥 Download Calendar (.ics)</span>
            <span *ngIf="isDownloading">⏳ Preparing Download...</span>
          </button>
          <button class="reset-btn" (click)="resetConverter()">
            🔄 Convert Another File
          </button>
        </div>

        <div class="download-status" *ngIf="downloadStatus" [class]="'status-' + downloadStatus.type">
          <div class="status-message">
            <span class="status-icon">
              {{ downloadStatus.type === 'success' ? '✅' : downloadStatus.type === 'error' ? '❌' : 'ℹ️' }}
            </span>
            {{ downloadStatus.message }}
          </div>
        </div>
      </div>

      <div class="no-events-card" *ngIf="parsedEvents.length === 0">
        <h2>⚠️ No Events Found</h2>
        <p>We couldn't detect any calendar events in the extracted text. Try uploading a file with clear date/time information.</p>
        <div class="extraction-info" *ngIf="extractedText.confidence">
          <p class="confidence-info">
            <span class="confidence-label">Text Extraction Confidence:</span>
            <span class="confidence-value" [class]="getConfidenceClass(extractedText.confidence)">
              {{ (extractedText.confidence * 100).toFixed(0) }}%
            </span>
          </p>
        </div>
        <button class="reset-btn" (click)="resetConverter()">
          🔄 Try Another File
        </button>
      </div>
    </div>
  </main>

  <div class="login-prompt" *ngIf="!(user$ | async)">
    <div class="prompt-content">
      <h2>🔐 Authentication Required</h2>
      <p>Please sign in with Google to use the file converter</p>
      <!-- Move sign-in component here when user is not authenticated -->
      <app-auth mode="login"></app-auth>
    </div>
  </div>
</div>

<router-outlet></router-outlet>
