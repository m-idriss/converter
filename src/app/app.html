<div class="app-container">
  <header class="app-header">
    <div class="header-content">
      <h1>üìÖ File to Calendar Converter</h1>
      <p class="header-subtitle">Convert images and PDFs to ICS calendar files using advanced OCR technology</p>
      <div class="how-it-works">
        <p class="process-description">
          Upload images or PDF files containing event information, and our intelligent system will automatically detect dates, times, locations, and event details to create downloadable calendar files compatible with Google Calendar, Outlook, and Apple Calendar.
        </p>
        <div class="supported-formats">
          <span class="format-label">Supported formats:</span>
          <span class="formats">JPG, PNG, PDF</span> ‚Ä¢ 
          <span class="output-label">Output:</span>
          <span class="output">ICS Calendar Files</span>
        </div>
      </div>
    </div>
    <!-- Only show auth component in header when user is connected -->
    <div *ngIf="user$ | async" class="header-auth">
      <app-auth mode="header"></app-auth>
    </div>
  </header>

  <main class="app-main" *ngIf="user$ | async">
    <!-- How it Works Section -->
    <div class="how-it-works-section" *ngIf="!showResults">
      <div class="process-steps">
        <h2>How It Works</h2>
        <div class="steps-container">
          <div class="step-item">
            <div class="step-number">1</div>
            <div class="step-content">
              <h3>üì§ Upload Your Document</h3>
              <p>Drag and drop or browse to select images (JPG, PNG) or PDF files containing event information.</p>
            </div>
          </div>
          <div class="step-item">
            <div class="step-number">2</div>
            <div class="step-content">
              <h3>üîç OCR Text Extraction</h3>
              <p>Our advanced OCR technology reads and extracts all text content from your documents with high accuracy.</p>
            </div>
          </div>
          <div class="step-item">
            <div class="step-number">3</div>
            <div class="step-content">
              <h3>üß† Smart Event Detection</h3>
              <p>AI algorithms analyze the text to identify event titles, dates, times, locations, and descriptions.</p>
            </div>
          </div>
          <div class="step-item">
            <div class="step-number">4</div>
            <div class="step-content">
              <h3>üìÖ Calendar Generation</h3>
              <p>Generate downloadable ICS files compatible with Google Calendar, Outlook, Apple Calendar, and more.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="converter-section" *ngIf="!showResults">
      <app-file-upload (textExtracted)="onTextExtracted($event)"> </app-file-upload>
    </div>

    <div class="results-section" *ngIf="showResults && extractedText">
      <div class="events-card" *ngIf="parsedEvents.length > 0">
        <div class="events-header">
          <h2>üìÖ Calendar Events ({{ parsedEvents.length }})</h2>
        </div>

        <div class="events-list iphone-style" #eventsList>
          <div
            class="event-item"
            *ngFor="let event of parsedEvents; trackBy: trackEvent; let i = index"
            [attr.data-color-index]="i % 3"
          >
            <!-- Date card on the left -->
            <div class="date-card">
              <div class="day-abbreviation">{{ getDayAbbreviation(event.startDate) }}</div>
              <div class="day-number">{{ event.startDate | date: 'd' }}</div>
            </div>

            <!-- Colored accent border -->
            <div class="accent-border" [attr.data-color]="getEventColor(i)"></div>

            <!-- Event content -->
            <div class="event-content">
              <div class="event-main">
                <div class="event-info">
                  <h3 class="event-title">{{ event.title }}</h3>
                  <p class="event-location" *ngIf="event.location">
                    <span class="location-icon">üìç</span>{{ event.location }}
                  </p>
                  <p
                    class="event-description"
                    *ngIf="event.description && event.description !== event.title"
                  >
                    {{ event.description }}
                  </p>
                </div>

                <div class="event-time">
                  <div class="time-start">{{ event.startDate | date: 'HH:mm' }}</div>
                  <div class="time-end">{{ event.endDate | date: 'HH:mm' }}</div>
                  <div
                    class="confidence-badge"
                    *ngIf="event.confidence"
                    [class]="getConfidenceClass(event.confidence)"
                  >
                    {{ (event.confidence * 100).toFixed(0) }}%
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button
            class="download-btn"
            (click)="downloadCalendar()"
            [disabled]="isDownloading"
            [class.downloading]="isDownloading"
          >
            <span *ngIf="!isDownloading">üì• Download Calendar (.ics)</span>
            <span *ngIf="isDownloading">‚è≥ Preparing Download...</span>
          </button>
          <button class="reset-btn" (click)="resetConverter()">üîÑ Convert Another File</button>
        </div>

        <div
          class="download-status"
          *ngIf="downloadStatus"
          [class]="'status-' + downloadStatus.type"
        >
          <div class="status-message">
            <span class="status-icon">
              {{
                downloadStatus.type === 'success'
                  ? '‚úÖ'
                  : downloadStatus.type === 'error'
                    ? '‚ùå'
                    : '‚ÑπÔ∏è'
              }}
            </span>
            {{ downloadStatus.message }}
          </div>
        </div>
      </div>

      <div class="no-events-card" *ngIf="parsedEvents.length === 0">
        <h2>‚ö†Ô∏è No Calendar Events Detected</h2>
        <div class="no-events-explanation">
          <p class="main-message">
            We couldn't detect any calendar events in the extracted text. This can happen for several reasons:
          </p>
          <div class="troubleshooting">
            <h3>üí° Tips for better results:</h3>
            <ul class="tips-list">
              <li><strong>Date Format:</strong> Ensure dates are clearly written (e.g., "March 15, 2024" or "15/03/2024")</li>
              <li><strong>Time Information:</strong> Include specific times (e.g., "2:00 PM" or "14:00")</li>
              <li><strong>Event Details:</strong> Have clear event titles and descriptions</li>
              <li><strong>Image Quality:</strong> Use high-resolution, well-lit images with clear text</li>
              <li><strong>Text Orientation:</strong> Ensure text is not rotated or skewed</li>
            </ul>
          </div>
          <div class="example-formats">
            <h3>üìã Example formats we recognize:</h3>
            <ul class="format-examples">
              <li>"Meeting on March 15, 2024 at 2:00 PM"</li>
              <li>"Conference: April 20th, 10:00 AM - 5:00 PM"</li>
              <li>"Appointment scheduled for 03/25/2024 at 3:30 PM"</li>
            </ul>
          </div>
        </div>
        <div class="extraction-info" *ngIf="extractedText.confidence">
          <p class="confidence-info">
            <span class="confidence-label">Text Extraction Confidence:</span>
            <span class="confidence-value" [class]="getConfidenceClass(extractedText.confidence)">
              {{ (extractedText.confidence * 100).toFixed(0) }}%
            </span>
          </p>
          <p class="confidence-help" *ngIf="extractedText.confidence < 0.8">
            <em>Low confidence may indicate poor image quality or unclear text. Try uploading a clearer image.</em>
          </p>
        </div>
        <button class="reset-btn" (click)="resetConverter()">üîÑ Try Another File</button>
      </div>
    </div>
  </main>

  <div class="login-prompt" *ngIf="!(user$ | async)">
    <div class="prompt-content">
      <h2>üîê Authentication Required</h2>
      <div class="auth-explanation">
        <p class="main-message">Please sign in with Google to use the file converter</p>
        <div class="why-auth">
          <h3>Why do we require authentication?</h3>
          <ul class="auth-benefits">
            <li><strong>Security:</strong> Protect your uploaded documents and ensure privacy</li>
            <li><strong>Processing Power:</strong> Access to advanced OCR and AI processing capabilities</li>
            <li><strong>File History:</strong> Keep track of your conversion history (optional)</li>
            <li><strong>Rate Limiting:</strong> Prevent abuse and ensure fair usage for all users</li>
          </ul>
          <p class="privacy-note">
            <em>Your documents are processed securely and are not stored permanently on our servers.</em>
          </p>
        </div>
      </div>
      <app-auth mode="login"></app-auth>
    </div>
  </div>
</div>

<router-outlet></router-outlet>
